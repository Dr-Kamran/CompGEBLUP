% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/10_design_matrices.R
\name{build_design_matrices}
\alias{build_design_matrices}
\title{Build Design Matrices for GBLUP}
\usage{
build_design_matrices(
  pheno,
  K_matrices,
  effects,
  use.sparse = FALSE,
  fixed = NULL
)
}
\arguments{
\item{pheno}{Phenotype data frame with GID, ENV, trait columns}

\item{K_matrices}{List of relationship matrices. Names must match \code{effects}.
For custom effects, include a matrix with the matching name.}

\item{effects}{Character vector of effects to include. Can mix built-in
(\code{"A"}, \code{"D"}, etc.) and custom names (e.g. \code{"RN"}, \code{"K_comb"}).}

\item{use.sparse}{Use sparse matrices for Z (default FALSE, set TRUE for large n)}

\item{fixed}{Optional fixed effects specification. Can be NULL (intercept only, default),
a one-sided formula (e.g., ~ TESTER), or a pre-built design matrix}
}
\value{
List with X, Z_list, K_list, and effect_names
}
\description{
Constructs X (fixed) and Z (random) design matrices based on
the phenotype data and specified effects. Supports sparse matrices
for improved memory efficiency with large datasets.
}
\details{
Built-in effects: \code{"A"}, \code{"D"}, \code{"ENV"}, \code{"AE"},
\code{"DE"}, \code{"AA"}, \code{"AAE"}. Any other effect name is treated
as a custom effect â€” a matching K matrix must be provided in
\code{K_matrices}. Custom kernels are auto-detected as GID-level
(n_gid x n_gid) or GID.ENV-level (n_gid\emph{n_env x n_gid}n_env) based
on dimensions.
}
\keyword{internal}
