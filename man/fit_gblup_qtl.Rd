% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/11_qtl_aware_gblup.R
\name{fit_gblup_qtl}
\alias{fit_gblup_qtl}
\title{Fit GBLUP Model with QTL as Fixed Effects}
\usage{
fit_gblup_qtl(
  gdata,
  Ka,
  Xa = NULL,
  effects = c("A", "ENV"),
  KaeE1 = NULL,
  KaeE2 = NULL,
  ridge = 0.001,
  nIters = 100,
  tolParConvLL = 1e-04,
  verbose = TRUE
)
}
\arguments{
\item{gdata}{GBLUPData object}

\item{Ka}{Reduced additive matrix (from build_qtl_aware_matrices)}

\item{Xa}{QTL genotype matrix for fixed effects (from build_qtl_aware_matrices)}

\item{effects}{Character vector of random effects ("A", "ENV", "AE")}

\item{KaeE1}{Optional list of per-QTL GxE matrices}

\item{KaeE2}{Optional residual GxE matrix}

\item{ridge}{Ridge parameter for numerical stability}

\item{nIters}{Maximum iterations for REML (default: 100). QTL-aware models are
more complex and may need more iterations than standard GBLUP.}

\item{tolParConvLL}{Convergence tolerance (default: 1e-4)}

\item{verbose}{Print progress}
}
\value{
GBLUPModel object with additional QTL effect estimates
}
\description{
Fits a genomic prediction model where major QTLs are treated as fixed effects
and the polygenic background is modeled with a reduced kinship matrix.
}
\examples{
\dontrun{
# Step 1: Run GWAS
K_full <- calc_relationship_matrices(gdata, matrices = "A")
gwas_res <- gwas(gdata, K_full)

# Step 2: Get significant QTLs
sig_qtl <- get_significant_markers(gwas_res, method = "bonferroni")

# Step 3: Build QTL-aware matrices
M <- gdata@genotypes
qtl_mats <- build_qtl_aware_matrices(M, qtl_markers = sig_qtl$marker)

# Step 4: Fit model with QTLs as fixed
model <- fit_gblup_qtl(gdata, Ka = qtl_mats$Ka, Xa = qtl_mats$Xa)

# Access QTL effects
print(model@qtl_effects)
}
}
