% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/03_model_fitting.R
\name{heritability}
\alias{heritability}
\title{Calculate heritability from GBLUP model}
\usage{
heritability(model, n_env = NULL)
}
\arguments{
\item{model}{GBLUPModel object}

\item{n_env}{Number of environments (auto-detected if NULL)}
}
\value{
Named numeric vector with heritability estimates. The vector contains:
\item{h2}{Narrow-sense heritability for mean performance (G×E as noise)}
\item{H2}{Broad-sense heritability for mean performance (G×E as noise)}
\item{h2_total}{Narrow-sense including G×E as genetic}
\item{H2_total}{Broad-sense including G×E as genetic}

The number of environments used in calculation is stored as an attribute
and can be accessed via \code{attr(result, "n_env")}.
}
\description{
Calculates narrow-sense (h²) and broad-sense (H²) heritability from
variance components estimated by GBLUP.
}
\details{
For multi-environment models, heritability can be computed two ways:

\strong{For selection on mean performance (default output):}
G×E interactions are treated as NOISE - they reduce selection accuracy.
\itemize{
\item h2_mean = Va / (Va + Vae/n_env + Ve)
\item H2_mean = (Va + Vd) / (Va + Vd + Vae/n_env + Vde/n_env + Ve)
}
Use this when selecting genotypes for stable performance across environments.

\strong{For variance partitioning:}
G×E interactions counted as genetic variance.
\itemize{
\item h2_total = (Va + Vae/n_env) / (Va + Vae/n_env + Ve)
\item H2_total = (Va + Vd + Vae/n_env + Vde/n_env) / Vp
}
Use this for understanding genetic architecture and variance components.

For single-environment models (n_env = 1), both give identical results.
}
\section{Warning - Interpretation}{

For multi-environment data, the default (h2, H2) assumes selection on
MEAN performance across environments. For single-environment selection
or variance partitioning, use h2_total and H2_total. When in doubt,
consult a quantitative geneticist.
}

\examples{
\dontrun{
model <- fit_gblup(gdata, K, effects = c("A", "AE"))
h <- heritability(model)

# For selection decisions:
h["h2"]       # Heritability of mean performance

# For variance partitioning:
h["h2_total"] # Total genetic variance explained

# Access number of environments:
attr(h, "n_env")
}
}
